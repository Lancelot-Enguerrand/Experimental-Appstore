{
  "schemaVersion": 2,
  "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json",
  "services": [
    {
      "name": "asset-rpo",
      "image": "zurielbax/asset-rpo:latest",
      "isMain": true,
      "internalPort": 80,
      "environment": [
          { "key": "APP_KEY", "value": "${ASSET_APP_KEY}" },
          { "key": "DB_HOST", "value": "asset-rpo-db" },
          { "key": "DB_USERNAME", "value": "tipi" },
          { "key": "DB_PASSWORD", "value": "${ASSET_DB_PASS}" },
          { "key": "DB_CONNECTION", "value": "pgsql" },
          { "key": "DB_PORT", "value": "5432" },
          { "key": "PHP_TZ", "value": "${TZ}" },
          { "key": "TIMEZONE", "value": "${TZ}" },
          { "key": "PUID", "value": "1000" },
          { "key": "PGID", "value": "1000" },
          { "key": "APP_NAME", "value": "Asset RPO" },
          { "key": "APP_ENV", "value": "production" },
          { "key": "APP_DEBUG", "value": "false" },
          { "key": "APP_URL", "value": "${APP_PROTOCOL-http}://${APP_DOMAIN}" },
          { "key": "ASSET_URL", "value": "${APP_PROTOCOL-http}://${APP_DOMAIN}" },
          { "key": "DB_DATABASE", "value": "asset" },
          { "key": "DB_PASSWORD_FILE", "value": "rootpass" },
          { "key": "CACHE_STORE", "value": "file" },
          { "key": "SESSION_DRIVER", "value": "file" },
          { "key": "SESSION_LIFETIME", "value": "240" },
          { "key": "SESSION_ENCRYPT", "value": "true" },
          { "key": "SESSION_PATH", "value": "/" },
          { "key": "SESSION_DOMAIN", "value": "${APP_DOMAIN}" },
          { "key": "SANCTUM_STATEFUL_DOMAINS", "value": "${APP_DOMAIN}" },
          { "key": "STARTUP_DELAY", "value": "5" },
          { "key": "TRUSTED_PROXIES", "value": "*" },
          { "key": "MAIL_MAILER", "value": "smtp" },
          { "key": "MAIL_HOST", "value": "${ASSET_MAIL_HOST}" },
          { "key": "MAIL_PORT", "value": "${ASSET_MAIL_PORT}" },
          { "key": "MAIL_USERNAME", "value": "${ASSET_MAIL_USERNAME}" },
          { "key": "MAIL_PASSWORD", "value": "${ASSET_MAIL_PASSWORD}" },
          { "key": "MAIL_ENCRYPTION", "value": "${ASSET_MAIL_ENCRYPTION:-tls}" },
          { "key": "MAIL_FROM_ADDRESS", "value": "${ASSET_MAIL_FROM_ADDRESS:-noreply@rpo.com}" },
          { "key": "MAIL_FROM_NAME", "value": "${ASSET_MAIL_FROM_NAME:-Asset RPO}" }
      ],
      "dependsOn": {
        "asset-rpo-db": {
          "condition": "service_healthy"
        }
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/data",
          "containerPath": "/data"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/conf",
          "containerPath": "/conf"
        }
      ]
    },
    {
      "name": "asset-rpo-db",
      "image": "postgres:17",
      "hostname": "asset-rpo-db",
      "environment": [
          { "key": "TZ", "value": "${TZ}" },
          { "key": "POSTGRES_DB", "value": "asset" },
          { "key": "POSTGRES_USER", "value": "tipi" },
          { "key": "POSTGRES_PASSWORD", "value": "${ASSET_DB_PASS}" }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/db",
          "containerPath": "/var/lib/postgresql/data"
        }
      ],
      "securityOpt": [
        "no-new-privileges:true"
      ],
      "healthCheck": {
        "interval": "10s",
        "timeout": "45s",
        "retries": 10,
        "test": "pg_isready -q -d asset -U tipi"
      }
    }
  ]
}
