{
  "services": [
    {
      "name": "ente",
      "image": "11notes/ente:latest",
      "isMain": true,
      "internalPort": 8080,
      "environment": {
        "TZ": "${TZ}",
        "POSTGRES_PASSWORD": "${ENTE_POSTGRES_PASSWORD}",
        "MINIO_ACCESS_KEY": "${ENTE_MINIO_ACCESS_KEY}",
        "MINIO_SECRET_KEY": "${ENTE_MINIO_SECRET_KEY}"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/ente",
          "containerPath": "/ente/etc"
        }
      ],
      "dependsOn": {
        "ente-db": {
          "condition": "service_healthy"
        }
      }
    },
    {
      "name": "ente-db",
      "image": "11notes/postgres:16",
      "environment": {
        "TZ": "${TZ}",
        "POSTGRES_PASSWORD": "${ENTE_POSTGRES_PASSWORD}"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/db/etc",
          "containerPath": "/postgres/etc"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/db/var",
          "containerPath": "/postgres/var"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/db/backup",
          "containerPath": "/postgres/backup"
        }
      ]
    },
    {
      "name": "ente-minio",
      "image": "${TZ}",
      "command": [
        "server",
        "/data",
        "--console-address",
        ":9001"
      ],
      "environment": {
        "TZ": "${TZ}",
        "MINIO_ACCESS_KEY": "${ENTE_MINIO_ACCESS_KEY}",
        "MINIO_SECRET_KEY": "${ENTE_MINIO_SECRET_KEY}",
        "MINIO_ROOT_USER": "root",
        "MINIO_ROOT_PASSWORD": "minio1234"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/minio/etc",
          "containerPath": "/root/.minio"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/minio/var",
          "containerPath": "/data"
        }
      ]
    },
    {
      "name": "ente-mc",
      "image": "minio/mc",
      "environment": {
        "TZ": "${TZ}",
        "MINIO_ACCESS_KEY": "${ENTE_MINIO_ACCESS_KEY}",
        "MINIO_SECRET_KEY": "${ENTE_MINIO_SECRET_KEY}"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/mc",
          "containerPath": "/root/.mc"
        }
      ],
      "entrypoint": "/bin/sh -c \" /usr/bin/mc config host add ente http://minio:9000 ${ENTE_MINIO_ACCESS_KEY} ${ENTE_MINIO_SECRET_KEY}; /usr/bin/mc mb --ignore-existing ente/default; exit 0;\"",
      "dependsOn": {
        "ente_minio": {
          "condition": "service_started"
        }
      }
    }
  ]
}
